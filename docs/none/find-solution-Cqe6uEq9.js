(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const A=Symbol("Comlink.proxy"),$=Symbol("Comlink.endpoint"),G=Symbol("Comlink.releaseProxy"),S=Symbol("Comlink.finalizer"),w=Symbol("Comlink.thrown"),C=t=>typeof t=="object"&&t!==null||typeof t=="function",U={canHandle:t=>C(t)&&t[A],serialize(t){const{port1:e,port2:n}=new MessageChannel;return T(t,e),[n,[n]]},deserialize(t){return t.start(),X(t)}},Y={canHandle:t=>C(t)&&w in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},O=new Map([["proxy",U],["throw",Y]]);function B(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function T(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(o){if(!o||!o.data)return;if(!B(n,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:s,type:i,path:l}=Object.assign({path:[]},o.data),c=(o.data.argumentList||[]).map(g);let a;try{const u=l.slice(0,-1).reduce((f,d)=>f[d],t),h=l.reduce((f,d)=>f[d],t);switch(i){case"GET":a=h;break;case"SET":u[l.slice(-1)[0]]=g(o.data.value),a=!0;break;case"APPLY":a=h.apply(u,c);break;case"CONSTRUCT":{const f=new h(...c);a=tt(f)}break;case"ENDPOINT":{const{port1:f,port2:d}=new MessageChannel;T(t,d),a=Z(f,[f])}break;case"RELEASE":a=void 0;break;default:return}}catch(u){a={value:u,[w]:0}}Promise.resolve(a).catch(u=>({value:u,[w]:0})).then(u=>{const[h,f]=E(u);e.postMessage(Object.assign(Object.assign({},h),{id:s}),f),i==="RELEASE"&&(e.removeEventListener("message",r),I(e),S in t&&typeof t[S]=="function"&&t[S]())}).catch(u=>{const[h,f]=E({value:new TypeError("Unserializable return value"),[w]:0});e.postMessage(Object.assign(Object.assign({},h),{id:s}),f)})}),e.start&&e.start()}function q(t){return t.constructor.name==="MessagePort"}function I(t){q(t)&&t.close()}function X(t,e){return M(t,[],e)}function p(t){if(t)throw new Error("Proxy has been released and is not useable")}function L(t){return y(t,{type:"RELEASE"}).then(()=>{I(t)})}const b=new WeakMap,x="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(b.get(t)||0)-1;b.set(t,e),e===0&&L(t)});function J(t,e){const n=(b.get(e)||0)+1;b.set(e,n),x&&x.register(t,e,t)}function K(t){x&&x.unregister(t)}function M(t,e=[],n=function(){}){let r=!1;const o=new Proxy(n,{get(s,i){if(p(r),i===G)return()=>{K(o),L(t),r=!0};if(i==="then"){if(e.length===0)return{then:()=>o};const l=y(t,{type:"GET",path:e.map(c=>c.toString())}).then(g);return l.then.bind(l)}return M(t,[...e,i])},set(s,i,l){p(r);const[c,a]=E(l);return y(t,{type:"SET",path:[...e,i].map(u=>u.toString()),value:c},a).then(g)},apply(s,i,l){p(r);const c=e[e.length-1];if(c===$)return y(t,{type:"ENDPOINT"}).then(g);if(c==="bind")return M(t,e.slice(0,-1));const[a,u]=_(l);return y(t,{type:"APPLY",path:e.map(h=>h.toString()),argumentList:a},u).then(g)},construct(s,i){p(r);const[l,c]=_(i);return y(t,{type:"CONSTRUCT",path:e.map(a=>a.toString()),argumentList:l},c).then(g)}});return J(o,t),o}function Q(t){return Array.prototype.concat.apply([],t)}function _(t){const e=t.map(E);return[e.map(n=>n[0]),Q(e.map(n=>n[1]))]}const H=new WeakMap;function Z(t,e){return H.set(t,e),t}function tt(t){return Object.assign(t,{[A]:!0})}function E(t){for(const[e,n]of O)if(n.canHandle(t)){const[r,o]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},o]}return[{type:"RAW",value:t},H.get(t)||[]]}function g(t){switch(t.type){case"HANDLER":return O.get(t.name).deserialize(t.value);case"RAW":return t.value}}function y(t,e,n){return new Promise(r=>{const o=et();t.addEventListener("message",function s(i){!i.data||!i.data.id||i.data.id!==o||(t.removeEventListener("message",s),r(i.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:o},e),n)})}function et(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const nt=400,rt=10,ot=.8,st=t=>t.length>0,it=(t,e)=>{const n=t.height*e;if(n<=t.width)return{width:n,height:t.height};{const r=t.width/e;return{width:t.width,height:r}}},V=t=>"url"in t;function*R(t,e){V(t)?yield e:(yield*R(t.first,e+1),yield*R(t.second,e+1))}const at=t=>{const e=[...R(t,0)];if(e.length===0)return 0;const n=Math.max(...e),r=Math.min(...e);return 1-(n-r)/n},ct={done:!1,hasNext:!1};function lt(t,...e){let n=t,r=e.map(s=>"lazy"in s?ut(s):void 0),o=0;for(;o<e.length;){if(r[o]===void 0||!ft(n)){let c=e[o];n=c(n),o+=1;continue}let s=[];for(let c=o;c<e.length;c++){let a=r[c];if(a===void 0||(s.push(a),a.isSingle))break}let i=[];for(let c of n)if(D(c,i,s))break;let{isSingle:l}=s.at(-1);n=l?i[0]:i,o+=s.length}return n}function D(t,e,n){if(n.length===0)return e.push(t),!1;let r=t,o=ct,s=!1;for(let[i,l]of n.entries()){let{index:c,items:a}=l;if(a.push(r),o=l(r,c,a),l.index+=1,o.hasNext){if(o.hasMany??!1){for(let u of o.next)if(D(u,e,n.slice(i+1)))return!0;return s}r=o.next}if(!o.hasNext)break;o.done&&(s=!0)}return o.hasNext&&e.push(r),s}function ut(t){let{lazy:e,lazyArgs:n}=t,r=e(...n);return Object.assign(r,{isSingle:e.single??!1,index:0,items:[]})}function ft(t){return typeof t=="string"||typeof t=="object"&&!!t&&Symbol.iterator in t}const j={asc:(t,e)=>t>e,desc:(t,e)=>t<e};function ht(t,e){let[n,...r]=e;if(!gt(n))return t(n,k(...r));let o=k(n,...r);return s=>t(s,o)}function k(t,e,...n){let r=typeof t=="function"?t:t[0],o=typeof t=="function"?"asc":t[1],{[o]:s}=j,i=e===void 0?void 0:k(e,...n);return(l,c)=>{let a=r(l),u=r(c);return s(a,u)?1:s(u,a)?-1:i?.(l,c)??0}}function gt(t){if(v(t))return!0;if(typeof t!="object"||!Array.isArray(t))return!1;let[e,n,...r]=t;return v(e)&&typeof n=="string"&&n in j&&r.length===0}const v=t=>typeof t=="function"&&t.length===1;function F(...t){return ht(dt,t)}const dt=(t,e)=>[...t].sort(e),yt=({sizeHomogeneity:t,score:e,balance:n,pictures:r})=>(r.length<=10?e*e:e)*(r.length>12?t*t:t)*n,mt=t=>t<=9||t===10?15:t===11?10:5,wt=t=>{const e=t[0].pictures.length,n=lt(t,F(yt),r=>r.slice(-mt(e)),F(r=>r.score));return n[n.length-1]},pt=t=>{let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++){const o=t[r],s=o.width*o.height;s<e&&(e=s),s>n&&(n=s)}return e/n},m=(t,e,n)=>{if(V(n))return[{position:t,dimension:e,url:n.url}];if(n.horizontal){const r=e.height*n.first.aspectRatio;return[...m(t,{width:r,height:e.height},n.first),...m({x:t.x+r,y:t.y},{width:e.width-r,height:e.height},n.second)]}else{const r=e.width/n.first.aspectRatio;return[...m(t,{width:e.width,height:r},n.first),...m({x:t.x,y:t.y+r},{width:e.width,height:e.height-r},n.second)]}},bt=(t,e,n,r)=>{const o=m({x:0,y:0},t,r),s=pt(o.map(i=>i.dimension));return{dimension:t,score:e,balance:n,sizeHomogeneity:s,pictures:o}},W=(t,e)=>t+Math.random()*(e-t+1)|0;class N{constructor(e,n,r){this.horizontal=e,this.first=n,this.second=r;const o=n.aspectRatio+r.aspectRatio;this.aspectRatio=e?o:n.aspectRatio*r.aspectRatio/o}aspectRatio=0}function*P(t){if(t.length===1)yield t[0];else for(let e=1;e<t.length;e++){const n=P(t.slice(0,e)),r=P(t.slice(e));for(const o of n)for(const s of r)yield new N(!0,o,s),yield new N(!1,o,s)}}const xt=t=>{if(t===2)return 1;const e=Math.floor(t/2),n=Math.max(1,Math.floor(t/4)),r=W(-n,n),o=e+r;return Math.max(1,Math.min(t-1,o))},z=t=>{const e=t.length;if(e===1)return t[0];const n=xt(e),r=z(t.slice(0,n)),o=z(t.slice(n));return new N(W(0,1)===0,r,o)};function*Et(t){for(;;)yield z(t)}const St={maxComputationTime:nt,randomizeThreshold:rt};var Tt=Object.freeze({__proto__:null,findSolution:(t,e,n)=>{const r={...St,...n},o=Date.now(),s=e.width/e.height,i=[],l=t.length>=r.randomizeThreshold,c=l?Et(t):P(t);for(const a of c){const h=1/(1+Math.abs(a.aspectRatio-s)),f=at(a);if(l&&(i.length>0&&f<=.4||h<ot))continue;const d=it(e,a.aspectRatio);if(i.push(bt(d,h,f,a)),l&&Date.now()-o>r.maxComputationTime)break}if(console.debug("solutions found: ",i.length),!st(i))throw new Error("No solution");return wt(i)}});T(Tt)})();
